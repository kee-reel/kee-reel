<!DOCTYPE html>
<html lang="ru">
	<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
	<meta name="description" content="IT простым языком">
	<meta name="generator" content="HUGO">

	<meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="/sass/main.min.2410c89c79b6e042a424a6cef6ba5cbff430844ddffbec9f142931da8c515642.css" integrity="sha256-JBDInHm24EKkJKbO9rpcv/QwhE3f&#43;&#43;yfFCkx2oxRVkI=">
    <title> IT простым языком </title>
</head>

<body>
	<div id="top"/>
<header>
    <div align="center">
        +---------------------------+<br>
        |.-------------------------.|<br>
        ||&nbsp;<a href="/">kee_reel@blog</a>:~$ cd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/c">c</a>&nbsp;&nbsp;<a href="/cpp">c++</a>&nbsp;&nbsp;<a href="/python">python</a>&nbsp;&nbsp;<a href="/linux">linux</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/opengl">opengl</a>&nbsp;&nbsp;<a href="/sql">sql</a>&nbsp;&nbsp;<a href="/network">networks</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/about">обо_мне</a>&nbsp;||<br>
        |.-------------------------.|<br>
        +-::---------------------::-+<br>
        .---------------------------.<br>
        &nbsp;//&nbsp;/o<a href="/links">o</a>oooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        &nbsp;//&nbsp;/oooooooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        //-------------------------------\\<br>
        \\-------------------------------//<br>
    </div>
    <hr>
</header>

		
	<div id="wrapper">
		<div class="container">
			<section id="main_content">
    
    
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/opengl/environment-setup/">◀ Установка окружения</a>
            
            
                <div></div>
            
        </div>
        <hr>
    
    <h1>OpenGL/C&#43;&#43;. Первое окно</h1>
    
    
        <h3>Время чтения: 6 мин</h3>
    
    <p>В этой статье я расскажу как происходит инициализация OpenGL и создаётся окно в котором мы будем всё отрисовывать.</p>
<p>В <a href="/opengl-cpp-environment-setup">прошлой</a> статье я рассказал как настроить окружение и запустить самый простой проект &ndash; продолжу с того, на чём остановился.</p>
<p>В левой части экрана ты можешь увидеть список всех проектов &ndash; найди там проект &ldquo;tutorial01_first_window&rdquo; и открой файл &ldquo;tutorial01.cpp&rdquo;.</p>
<p><img src="/assets/images/opengl-cpp-qtcreator-projects.png" alt="Список проектов в QtCreator"></p>
<p>Там ты увидишь код, который инициализирует все библиотеки и создаёт окно &ndash; давай разберём по порядку.</p>
<h3 id="подключаем-стандартные-заголовки">Подключаем стандартные заголовки</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Include standard headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span></code></pre></div><p>Тут никаких откровений &ndash; стандартные библиотеки C++ для вывода логов через всякие printf.</p>
<h3 id="подключаем-заголовочный-файл-glew">Подключаем заголовочный файл GLEW</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Include GLEW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;GL/glew.h&gt;</span><span style="color:#75715e">
</span></span></span></code></pre></div><p>GLEW это обёртка над OpenGL, которая подключает самые свежие функции OpenGL, поддерживаемые твоей системой.</p>
<blockquote>
<p>У них на <a href="http://glew.sourceforge.net/">сайте</a> написано: &ldquo;OpenGL Extension Wrangler Library (GLEW) это кросс-платформенная C++ библиотека с открытым исходным кодом для загрузки расширений. GLEW предоставляет эффективный механизм, который в реальном времени определяет какие расширения OpenGL поддержаны на целевой платформе. Вся базовая функциональность OpenGL и его расширений предоставляется в едином заголовочном файле.</p>
</blockquote>
<p>Почему в OpenGL сразу не включены все функции, зачем какие-то расширения?</p>
<p>OpenGL <a href="https://www.khronos.org/opengl/wiki/OpenGL_Extension">сообщает</a>, что базовая функциональность OpenGL работает <strong>везде</strong>, а вот работоспособность расширений уже зависит от конкретного железа и операционной системы. Поэтому и приходится сначала смотреть что у тебя за система, а потом подключать функции.</p>
<h3 id="подключаем-заголовочный-файл-glfw-и-создаём-указатель-на-окно">Подключаем заголовочный файл GLFW и создаём указатель на окно</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Include GLFW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;GLFW/glfw3.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>GLFWwindow<span style="color:#f92672">*</span> window;
</span></span></code></pre></div><p>GLFW это библиотека, в которой спрятана вся платформенно-зависимая логика создания окон и управления вводом. Без неё пришлось бы для разработки под Windows разбираться с Win API, под Linux &ndash; с Linux API, а под MacOS &ndash; Cocoa API.</p>
<blockquote>
<p>У них на <a href="https://www.glfw.org/">сайте</a> написано: &ldquo;GLFW это кросс-платформенная библиотека с открытым исходным кодом для разработки с применением OpenGL, OpenGL ES и Vulkan. GLFW предоставляет простой API для создания окон, контекстов и поверхностей, а также получения ввода и системных событий.&rdquo;</p>
</blockquote>
<p>Кроме подключения заголовочника, мы ещё создаём указатель на объект окна, который в дальнейшем создадим.</p>
<h3 id="подключаем-заголовочный-файл-glm">Подключаем заголовочный файл GLM</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Include GLM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;glm/glm.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> glm;
</span></span></code></pre></div><p>GLM это библиотека, которая реализует множество математических конструкций и операций над ними &ndash; они нам пригодятся в дальнейшем.</p>
<blockquote>
<p>У них в <a href="https://github.com/g-truc/glm">гитхабе</a> написано: OpenGL Mathematics (GLM) это математическая библиотека из заготовочных файлов, основанная на спецификации к OpenGL Shading Language (GLSL).</p>
</blockquote>
<p>Ну вроде всё, с библиотеками закончили, теперь к самому коду!</p>
<h3 id="инициализация-glfw">Инициализация GLFW</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Initialise GLFW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span>( <span style="color:#f92672">!</span>glfwInit() )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    fprintf( stderr, <span style="color:#e6db74">&#34;Failed to initialize GLFW</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> );
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glfwWindowHint(GLFW_SAMPLES, <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE); <span style="color:#75715e">// To make MacOS happy; should not be needed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);
</span></span></code></pre></div><p>Первыми делом в main() мы инициализируем библиотеку GLFW, чтобы приступить к созданию окна.</p>
<p>После этого мы выставляем ряд параметров для окна GLFW:</p>
<ul>
<li>GLFW_SAMPLES &ndash; выбираем 4-х кратный экранный буфер для сглаживания <a href="https://en.wikipedia.org/wiki/Multisample_anti-aliasing">MSAA</a>. Если эту опцию не ставить, то без сглаживания все линии будут рисоваться <a href="https://en.wikipedia.org/wiki/Jaggies">лесенкой</a>.</li>
<li>GLFW_CONTEXT_VERSION_MAJOR и GLFW_CONTEXT_VERSION_MINOR &ndash; задают версию OpenGL, которую будет использовать приложение</li>
<li>GLFW_OPENGL_FORWARD_COMPAT &ndash; опция для выставления совместимости в экзотических случаях: &ldquo;можно использовать более новую версию OpenGL, если необходимо&rdquo;</li>
<li>GLFW_OPENGL_PROFILE &ndash; выбор подмножества функций OpenGL</li>
</ul>
<p>Подробное описание этих и кучи других параметров можно найти <a href="https://www.glfw.org/docs/latest/window.html">здесь</a>.</p>
<h3 id="создаём-окно">Создаём окно</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Open a window and create its OpenGL context
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>window <span style="color:#f92672">=</span> glfwCreateWindow( <span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">768</span>, <span style="color:#e6db74">&#34;Tutorial 01&#34;</span>, NULL, NULL);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>( window <span style="color:#f92672">==</span> NULL ){
</span></span><span style="display:flex;"><span>    fprintf( stderr, <span style="color:#e6db74">&#34;Failed to open GLFW window. If you have an Intel GPU, they are not 3.3 compatible. Try the 2.1 version of the tutorials.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> );
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    glfwTerminate();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>glfwMakeContextCurrent(window);
</span></span></code></pre></div><p>Вызываем функцию библиотеки GLFW для создания окна, и указываем там его ширину, высоту и заголовок. После этого делаем контекст окна активным.</p>
<blockquote>
<p>Контекст &ndash; это объект из OpenGL, который в себе хранит всё-всё-всё относящееся к OpenGL (текстуры, полигоны и т.д.). GLFW заботливо заворачивает внутрь окна контекст OpenGL &ndash; мы можем создать несколько окон с разными контекстами (несколько окон с разными играми), а можем создать несколько окон с одним и тем же контекстом (одна игра на несколько окон).</p>
</blockquote>
<h3 id="инициализация-glew">Инициализация GLEW</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Initialize GLEW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (glewInit() <span style="color:#f92672">!=</span> GLEW_OK) {
</span></span><span style="display:flex;"><span>    fprintf(stderr, <span style="color:#e6db74">&#34;Failed to initialize GLEW</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    getchar();
</span></span><span style="display:flex;"><span>    glfwTerminate();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Инициализируем GLEW, а вместе с ней и сам OpenGL.</p>
<h3 id="включаем-отслеживание-клавиш-для-текущего-окна">Включаем отслеживание клавиш для текущего окна</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Ensure we can capture the escape key being pressed below
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glfwSetInputMode(window, GLFW_STICKY_KEYS, GL_TRUE);
</span></span></code></pre></div><h3 id="выставляем-цвет-очистки-окна">Выставляем цвет очистки окна</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Dark blue background
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glClearColor(<span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">0.0f</span>, <span style="color:#ae81ff">0.4f</span>, <span style="color:#ae81ff">0.0f</span>);
</span></span></code></pre></div><p>Выставляем цвет очистки окна в формате RGB (последний аргумент это альфа-канал, про него потом).</p>
<p>В OpenGL каждый кадр открисовывается заново. Представь как художники рисуют анимации &ndash; они рисуют сразу все кадры на отдельных холстах, а потом их меняют. OpenGL &ndash; это художник, у которого есть только два &ldquo;холста&rdquo;:</p>
<ul>
<li>OpenGL показывает пользователю первый &ldquo;холст&rdquo;</li>
<li>В это время весь второй &ldquo;холст&rdquo; заливается сплошным цветом (в нашем случае синим)</li>
<li>Поверх этого цвета рисуются наши 3D-модели</li>
<li>OpenGL меняет местами первый и второй &ldquo;холст&rdquo; &ndash; теперь второй показывается пользователю, а первый перерисовывается</li>
</ul>
<p>&ldquo;Холст&rdquo; называется кадром, и этот процесс происходит очень быстро. Например 60 FPS, это 60 кадров в секунду &ndash; каждые 16 миллисекунд OpenGL заканчивает рисовать кадр и меняет его с предыдущим.</p>
<p>Такой механизм, в котором есть два кадра &ndash; &ldquo;в перерисовке&rdquo; и &ldquo;готовый&rdquo; &ndash; называется двойной буфферизацией.</p>
<h3 id="зачищаем-окно-и-слушаем-ввод-с-клавиатуры">Зачищаем окно и слушаем ввод с клавиатуры</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">do</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Clear the screen. It&#39;s not mentioned before Tutorial 02, but it can cause flickering, so it&#39;s there nonetheless.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    glClear( GL_COLOR_BUFFER_BIT );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Swap buffers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    glfwSwapBuffers(window);
</span></span><span style="display:flex;"><span>    glfwPollEvents();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// Check if the ESC key was pressed or the window was closed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span>( glfwGetKey(window, GLFW_KEY_ESCAPE ) <span style="color:#f92672">!=</span> GLFW_PRESS <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        glfwWindowShouldClose(window) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> );
</span></span></code></pre></div><p>Вызываем функцию OpenGL glClear(), которая очищает экран указанным в glClearColor() цветом. GL_COLOR_BUFFER_BIT говорит о том, что нужно почистить только цвет (да, в OpenGL на экране хранится не только цвет, но об этом тоже потом).</p>
<p>Функция glfwSwapBuffers() делает то, о чём я говорил &ndash; меняет кадры &ldquo;в перерисовке&rdquo; и &ldquo;готовый&rdquo; местами.</p>
<p>Фунцкия glfwPollEvents() запрашивает у системы новые события &ndash; это нужно чтобы отслеживать нажатие клавиш и прочее.</p>
<p>В условии цикла while:</p>
<ul>
<li>Через функцию glfwGetKey() мы забираем текущее состояние кнопки Escape и сравниваем с состоянием GLFW_PRESS. Без этой проверки окно не закроется при нажатии Escape.</li>
<li>Вызыввем функцию  чтобы получить текущее состояние окна &ndash; если пользователь нажал крестик на окне или Alt+F4, то вернётся 1. Без этой проверки окно не закроется при нажатии на крестик.</li>
</ul>
<h3 id="высвобождаем-ресурсы">Высвобождаем ресурсы</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Close OpenGL window and terminate GLFW
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>glfwTerminate();
</span></span></code></pre></div><p>Говорим GLFW сворачиваться, а он за нас зачистит и объект окна window, и сам OpenGL &ndash; просто сказка, а не библиотека!</p>
<h1 id="задание-на-закрепление">Задание на закрепление</h1>
<blockquote>
<p>Задания на закрепления всегда очень простые и преследуют цель вовлечь тебя в процесс экспериментирования (ведь это интересно).</p>
</blockquote>
<ul>
<li>Замени цвет очистки окна на свой любимый цвет. Вот мой любимый цвет:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>glClearColor(<span style="color:#ae81ff">0.f</span>, <span style="color:#ae81ff">227.f</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255.f</span>, <span style="color:#ae81ff">253.f</span><span style="color:#f92672">/</span><span style="color:#ae81ff">255.f</span>, <span style="color:#ae81ff">0.0f</span>);
</span></span></code></pre></div><ul>
<li>Плавная смена цвета:
<ul>
<li>Перенеси функцию glClearColor() внутрь цикла while()</li>
<li>создай вне цикла float переменную i</li>
<li>Добавь внутрь цикла изменение i на 0.0001</li>
<li>Подставь i вместо одной из компонент цвета в функцию glClearColor()</li>
</ul>
</li>
</ul>
<h1 id="header-1заключение"><a href="#header-1"></a>Заключение</h1>
<p>Итого, мы изучили:</p>
<ul>
<li>Что такое библиотеки:
<ul>
<li>GLEW (управляет расширениями OpenGL)</li>
<li>OpenGL (базовая функциональность + расширения)</li>
<li>GLFW (кросс-платформенная библиотека для создания и управления окнами)</li>
<li>GLM (библиотека для математики)</li>
</ul>
</li>
<li>Двойная буфферизация (два холста)</li>
</ul>
<p>В следующей статье ты нарисуешь самый настоящий треугольник! Это будет поворотным моментом в твоём обучениии, ведь даже самые крутые и сложные 3D-модели будут состоять из тех же самых треугольников.</p>

    <hr>
    <div align="center">
        <a href="https://kee-reel.com/opengl/first-window/#top">▲ В начало ▲</a>
    </div>
    
        <hr>
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/opengl/environment-setup/">◀ Установка окружения</a>
            
            
                <div></div>
            
        </div>
    

			</section>
		</div>
	</div>

    <footer>
    <hr>
    <div align="center">
        Home server: Raspberry Pi 4<br>
        Temperature: 53<br>
Uptime: 1 hour, 7 minutes
    </div>
</footer>

</body>
</html>
