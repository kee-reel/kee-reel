<!DOCTYPE html>
<html lang="ru">
	<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
	<meta name="description" content="IT простым языком">
	<meta name="generator" content="HUGO">

	<meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="/sass/main.min.2410c89c79b6e042a424a6cef6ba5cbff430844ddffbec9f142931da8c515642.css" integrity="sha256-JBDInHm24EKkJKbO9rpcv/QwhE3f&#43;&#43;yfFCkx2oxRVkI=">
    <title> IT простым языком </title>
</head>

<body>
	<div id="top"/>
<header>
    <div align="center">
        +---------------------------+<br>
        |.-------------------------.|<br>
        ||&nbsp;<a href="/">kee_reel@blog</a>:~$ cd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/c">c</a>&nbsp;&nbsp;<a href="/cpp">c++</a>&nbsp;&nbsp;<a href="/python">python</a>&nbsp;&nbsp;<a href="/linux">linux</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/opengl">opengl</a>&nbsp;&nbsp;<a href="/sql">sql</a>&nbsp;&nbsp;<a href="/network">networks</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/about">обо_мне</a>&nbsp;||<br>
        |.-------------------------.|<br>
        +-::---------------------::-+<br>
        .---------------------------.<br>
        &nbsp;//&nbsp;/o<a href="/links">o</a>oooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        &nbsp;//&nbsp;/oooooooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        //-------------------------------\\<br>
        \\-------------------------------//<br>
    </div>
    <hr>
</header>

		
	<div id="wrapper">
		<div class="container">
			<section id="main_content">
    
    
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/python/first-project/">◀ Первый проект</a>
            
            
                <div></div>
            
        </div>
        <hr>
    
    <h1>Python. Первый проект. Регистрация</h1>
    
    
        <h3>Время чтения: 3 мин</h3>
    
    <p>Эта статья из цикла статей <a href="../first-project">&ldquo;Первый проект&rdquo;</a>, в которых я шаг за шагом показываю как разработать систему, близкую по сложности к реальной.</p>
<p>В этой статье я реализую регистрацию, а в следующей &ndash; авторизацию по логину/паролю. Для фреймворка Flask уже есть готовое решение для этой задачи: <a href="https://www.askpython.com/python-modules/flask/flask-user-authentication">flask_login</a>. С целью постижения глубинной природы вещей, я покажу как реализовать это самому, без использования сторонних библиотек.</p>
<h1 id="новые-endpointы">Новые endpoint&rsquo;ы</h1>
<p>Расширю простейший веб-сервер и добавлю двe новых конечных точки (endpont):</p>
<ul>
<li>login
<ul>
<li>GET:
<ul>
<li>Возвращает HTML страницу для логина</li>
</ul>
</li>
<li>POST:
<ul>
<li>Будет принимает введённое пользователем имя</li>
<li>Если такого пользователя ещё нет, то регистрирует его в базе данных</li>
<li>Если не получилось зарегистрировать, то возвращает ошибку</li>
<li>Записывает имя пользователя в cookie (про cookie ниже)</li>
<li>Возвращает &ldquo;успех&rdquo;</li>
</ul>
</li>
</ul>
</li>
<li>profile
<ul>
<li>GET:
<ul>
<li>Проверяет какое имя записано в cookie</li>
<li>Если такой пользователь зарегистрирован, то возвращает страницу с приветствием</li>
<li>Если пользователь неизвестен, то возвращает страницу с предложением залогиниться/зарегистрироваться</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="cookie">Cookie</h1>
<p>Cookie (печенька) &ndash; файл с данными сайта, хранящийся на машине пользователя. При заходе на сайт, пользователь отправляет cookie для этого сайта.</p>
<p>С помощью cookie, веб-сервер может сохранять какие-либо данные на машине пользователя. В основном это используется для того, чтобы понять что этот пользователь уже логинился на сайте. Кроме этого в cookie можно записать дополнительную информацию &ndash; например какую страницу пользователь просматривал в последний раз, где остановился, какую цветовую схему предпочитает.</p>
<p>Без cookie веб сервер никак не сможет понять из под какого пользователя ты заходишь &ndash; для веб сервера все запросы почти одинаковы.</p>
<p>В этой статье я покажу как записать в cookie имя пользователя, чтобы при заходе на сервер мы могли его узнать по этому имени.</p>
<h1 id="реализация">Реализация</h1>
<p>Так как со временем размер проекта сильно вырастет, я решил не вставлять весь код в статью, а создать <a href="https://gitlab.com/kee-reel/python-tutorial-web-courses/-/tree/main/1_registration">отдельный репозиторий</a> со всеми файлами проекта. Его можно скачать себе и запустить, а можно посмотреть содержимое отдельных файлов.</p>
<p>Я добавил HTML шаблоны для главной страницы и страниц логина и профиля:</p>
<ul>
<li>
<p>Главная &ndash; index.html</p>
</li>
<li>
<p>Логин &ndash; login.html</p>
</li>
<li>
<p>Профиль &ndash; profile.html</p>
</li>
</ul>
<blockquote>
<p>Не забываем что файлы шаблонов должны лежать в папке &ldquo;templates&rdquo;, чтобы Flask смог их найти.</p>
</blockquote>
<p>На сервере я изменил логику основного файла и добавил два файла:</p>
<ul>
<li>
<p>__main__.py &ndash; добавил два endpoint&rsquo;а и логику обработки запросов</p>
</li>
<li>
<p>database.py &ndash; где будет реализован класс DB, для работы с базой данных. Объект этого класса создаётся глобально в этом же файле &ndash; вся логика взаимодействует с базой данных через этот объект</p>
</li>
<li>
<p>user.py &ndash; где будет реализован класс User, для работы с пользовательскими данными</p>
</li>
</ul>
<p>В основном файле я, кроме изменения логики, добавил 5 новых импортов:</p>
<ul>
<li>render_template &ndash; подготовка HTML шаблона</li>
<li>request &ndash; объект из которого можно получить параметры POST запроса</li>
<li>make_response &ndash; подготовка ответа на POST запрос (нужен чтобы прокинуть cookie пользователю)</li>
<li>redirect &ndash; подготовка ответа на GET/POST запрос, который позволит перенаправить пользователя на другой endpoint</li>
<li>jsonify &ndash; подготавливает данные для ответа клиенту в JSON формате</li>
</ul>
<p>Получилось такое поведение веб-сервера:</p>
<p><img src="/assets/images/python-web-registration-basic.png" alt="Страницы"></p>
<p>Моменты, которые стоит явно выделить:</p>
<ul>
<li>Имя пользователя хранится в cookie и на сервере.</li>
<li>Если пользователь почистит кэш и удалит cookie (или зайдёт с другого браузера/компьютера), то веб сайт его не узнает и попросит залогиниться/зарегистрироваться.</li>
<li>Если при логине он укажет имя, которое уже содержится в базе данных, то это имя только добавится в cookie (не будет добавляться в базу данных).</li>
<li>Сейчас, любой пользователь может зайти из под любого пользователя, так как пользователь не указывает пароль, и всё что нужно для логина &ndash; это знать имя пользователя.</li>
</ul>
<p>В следующей статье я опишу то, как сделать авторизацию пользователя по паре логин/пароль, чтобы обезопасить профиль пользователя.</p>
<p><img src="/assets/images/python-first-project-naive-authorization.png" alt="Naive auth"></p>

    <hr>
    <div align="center">
        <a href="https://kee-reel.com/python/web-reg-and-auth/#top">▲ В начало ▲</a>
    </div>
    
        <hr>
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/python/first-project/">◀ Первый проект</a>
            
            
                <div></div>
            
        </div>
    

			</section>
		</div>
	</div>

    <footer>
    <hr>
    <div align="center">
        Home server: Raspberry Pi 4<br>
        Temperature: 53<br>
Uptime: 1 hour, 7 minutes
    </div>
</footer>

</body>
</html>
