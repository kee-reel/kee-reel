<!DOCTYPE html>
<html lang="ru">
	<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
	<meta name="description" content="IT простым языком">
	<meta name="generator" content="HUGO">

	<meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="/sass/main.min.2410c89c79b6e042a424a6cef6ba5cbff430844ddffbec9f142931da8c515642.css" integrity="sha256-JBDInHm24EKkJKbO9rpcv/QwhE3f&#43;&#43;yfFCkx2oxRVkI=">
    <title> IT простым языком </title>
</head>

<body>
	<div id="top"/>
<header>
    <div align="center">
        +---------------------------+<br>
        |.-------------------------.|<br>
        ||&nbsp;<a href="/">kee_reel@blog</a>:~$ cd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/c">c</a>&nbsp;&nbsp;<a href="/cpp">c++</a>&nbsp;&nbsp;<a href="/python">python</a>&nbsp;&nbsp;<a href="/linux">linux</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/opengl">opengl</a>&nbsp;&nbsp;<a href="/sql">sql</a>&nbsp;&nbsp;<a href="/network">networks</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/about">обо_мне</a>&nbsp;||<br>
        |.-------------------------.|<br>
        +-::---------------------::-+<br>
        .---------------------------.<br>
        &nbsp;//&nbsp;/o<a href="/links">o</a>oooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        &nbsp;//&nbsp;/oooooooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        //-------------------------------\\<br>
        \\-------------------------------//<br>
    </div>
    <hr>
</header>

		
	<div id="wrapper">
		<div class="container">
			<section id="main_content">
    
    
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/python/web-server/">◀ Основы веб-сервера Flask</a>
            
            
                <a href="https://kee-reel.com/python/web-reg-and-auth/">Первый проект. Регистрация ▶</a>
            
        </div>
        <hr>
    
    <h1>Python. Первый проект</h1>
    
    
        <h3>Время чтения: 4 мин</h3>
    
    <p>В этой статье я приведу пример задачи на ООП и покажу как её решить. После этого я дам несколько самостоятельных заданий.</p>
<h1 id="читаем-тз">Читаем ТЗ</h1>
<p>Представляем ситуацию &ndash; ты пришёл работать в компанию, которая занимается продажей обучающих курсов. До тебя никто не занимался автоматизацией, и все задачи выполнялись вручную.</p>
<p>Директор даёт тебе такое техническое задание:</p>
<ul>
<li>Создать сайт, на котором пользователи смогут зарегистрироваться</li>
<li>Зарегистрированный пользователь может оплатить курс
<ul>
<li>Оплата курса на данном этапе не встроена в сайт, и пользователь напрямую связывается с сотрудником компании</li>
<li>Сотрудник компании может зайти на сайт под своим профилем, и отметить какой курс был куплен каким пользователем</li>
</ul>
</li>
<li>После оплаты пользователь может просматривать материалы курса
<ul>
<li>Курс состоит из N занятий</li>
<li>Каждое занятие является произвольной веб-страницей</li>
</ul>
</li>
</ul>
<p>Кажется сложным, поэтому давай сначала продумаем архитектуру нашей системы.</p>
<p>Вот, я набросал UML диаграмму, на которой отразил архитектуру системы в целом (слева) и архитектуру сервера в частности (справа).</p>
<p><img src="/assets/images/python-courses-uml.png" alt="UML диаграмма"></p>
<blockquote>
<p>UML (Unified Modeling Language) &ndash; унифицированный язык описания систем программного обеспечения.
Я рисовал через программу <a href="https://github.com/jgraph/drawio-desktop/releases/">draw.io</a>.</p>
</blockquote>
<p>С точки зрения архитектуры всей системы, можно выделить следующие компоненты:</p>
<ul>
<li>Пользователь &ndash; будет пользоваться сайтом, чтобы смотреть курсы</li>
<li>Сотрудник &ndash; будет определять доступ пользователя к курсам</li>
<li>Администратор &ndash; будет определять кто из пользователей является сотрудником</li>
<li>Сервер &ndash; содержит всю логику сайта</li>
<li>База данных &ndash; содержит данные, необходимые пользователям и сотрудникам</li>
</ul>
<p>С точки зрения архитектуры сервера, можно выделить следующие компоненты:</p>
<ul>
<li>Пользователь:
<ul>
<li>Уникальный для каждого пользователя id</li>
<li>Имя пользователя</li>
<li>Статус сотрудника (да/нет)</li>
<li>Список купленных курсов</li>
<li>Метод, позволяющий изменить статус сотрудника (будет изменяться администратором сервера)</li>
<li>Метод, позволяющий изменить состав купленных курсов (будет изменяться сотрудником)</li>
<li>Метод, позволяющий проверить был ли куплен тот или иной курс</li>
</ul>
</li>
<li>Курс
<ul>
<li>Уникальный для каждого курса id</li>
<li>Название курса</li>
<li>Веб-страница, на которой размещены занятия</li>
<li>Список уникальных id занятий</li>
<li>Метод, позволяющий показать пользователю страницу покупки курса</li>
<li>Метод, позволяющий показать пользователю страницу курса (если курс куплен)</li>
</ul>
</li>
<li>Занятие
<ul>
<li>Уникальный для каждого занятия id</li>
<li>Название занятия</li>
<li>Веб-страница занятия</li>
<li>Метод, позволяющий показать пользователю страницу занятия (если курс куплен)</li>
</ul>
</li>
</ul>
<p>Рисовать диаграммы перед разработкой &ndash; хорошая практика. Рисуя диаграмму, можно сразу примерно понять какие классы необходимо создать и как они будут друг с другом связаны, что потенциально сократит время разработки.</p>
<h1 id="начинаем-разработку">Начинаем разработку</h1>
<p>В нашей программе будут использованы СУБД SQLite (<a href="/sql/intro">разбор</a>) и веб-фреймворк Flask (<a href="../web-server">разбор</a>).</p>
<p>Я начну с организации базы данных.</p>
<h1 id="организуем-базу-данных">Организуем базу данных</h1>
<p>Основываясь на архитектуре сервера можно определить, что нам нужно хранить следующие данные:</p>
<ul>
<li>Пользователь:
<ul>
<li>Уникальный для каждого пользователя id</li>
<li>Имя пользователя</li>
<li>Статус сотрудника (да/нет)</li>
<li>Список купленных курсов</li>
</ul>
</li>
<li>Курс
<ul>
<li>Уникальный для каждого курса id</li>
<li>Название курса</li>
<li>Веб-страница, на которой размещены занятия</li>
<li>Список уникальных id занятий</li>
</ul>
</li>
<li>Занятие
<ul>
<li>Уникальный для каждого занятия id</li>
<li>Название занятия</li>
<li>Веб-страница занятия</li>
</ul>
</li>
</ul>
<p>Переведём это на язык запросов SQL:</p>
<ul>
<li>Пользователь</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">user</span>(
</span></span><span style="display:flex;"><span>	id INTEGER <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>	name TEXT,
</span></span><span style="display:flex;"><span>	is_employee BOOLEAN
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><ul>
<li>Курс</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> course(
</span></span><span style="display:flex;"><span>	id INTEGER <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>	name TEXT,
</span></span><span style="display:flex;"><span>	page_file TEXT
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><ul>
<li>Занятие</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> lesson(
</span></span><span style="display:flex;"><span>	id INTEGER <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>	name TEXT,
</span></span><span style="display:flex;"><span>	page_file TEXT
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>Так как в SQL нельзя хранить списки в полях таблицы, мы создадим две дополнительных таблицы, чтобы хранить:</p>
<ul>
<li>Связь пользователь-купленный курс</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> user_to_course(
</span></span><span style="display:flex;"><span>	user_id INTEGER,
</span></span><span style="display:flex;"><span>	course_id INTEGER,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(user_id, course_id)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><ul>
<li>Связь курс-занятие</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> course_to_lesson(
</span></span><span style="display:flex;"><span>	course_id INTEGER,
</span></span><span style="display:flex;"><span>	lesson_id INTEGER,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(course_id, lesson_id)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>Таким образом, чтобы узнать какие курсы были куплены у пользователя, нужно будет посмотреть на все записи в таблице user_to_course, где user_id равен id пользователя. Вот как будет выглядеть такой запрос на SQL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- 666 это просто какой-то id пользователя
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> course_id <span style="color:#66d9ef">FROM</span> user_to_course <span style="color:#66d9ef">WHERE</span> user_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">666</span>;
</span></span></code></pre></div><p>Получив курсы, пользователь сможет открыть один из них, и посмотреть какие в курсе есть занятия. Вот как на SQL я вытащу все занятия для курса:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- 666 это просто какой-то id курса
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> lesson_id <span style="color:#66d9ef">FROM</span> course_to_lesson <span style="color:#66d9ef">WHERE</span> course_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">666</span>;
</span></span></code></pre></div><p>По ТЗ не надо реализовывать &ldquo;админку&rdquo; для наполнения курсов занятиями, поэтому первоначальное наполнение базы будем делать через SQLiteBrowser.</p>
<h1 id="пишем-сервер">Пишем сервер</h1>
<p>Начнём с кода, который поднимает простейший веб-сервер на Flask:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(<span style="color:#e6db74">&#39;courses&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;test&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>run(port<span style="color:#f92672">=</span><span style="color:#ae81ff">1234</span>)
</span></span></code></pre></div><p>Окей, всё работает. Осталось дело за малым &ndash; дописать всю остальную систему :)</p>
<p>Каждый аспект реализации сервера я вынесу в отдельную статью, где подробно разберу и объясню что и зачем делаю.</p>
<ul>
<li><a href="../web-reg-and-auth">Регистрация</a> &ndash; без неё не будет пользователей, а без пользователей не будет продаж курсов.</li>
<li>Авторизация &ndash; пользователи могут заходить только под своими профилями (под чужими нельзя).</li>
<li>&hellip;</li>
</ul>
<p>&hellip;</p>
<h1 id="заключение">Заключение</h1>
<p>Итого, мы изучили:</p>
<ul>
<li>Заполню после написания всех статей</li>
</ul>
<p>Если что &ndash; пиши, я помогу и постараюсь объяснить лучше.</p>

    <hr>
    <div align="center">
        <a href="https://kee-reel.com/python/first-project/#top">▲ В начало ▲</a>
    </div>
    
        <hr>
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/python/web-server/">◀ Основы веб-сервера Flask</a>
            
            
                <a href="https://kee-reel.com/python/web-reg-and-auth/">Первый проект. Регистрация ▶</a>
            
        </div>
    

			</section>
		</div>
	</div>

    <footer>
    <hr>
    <div align="center">
        Home server: Raspberry Pi 4<br>
        Temperature: 53<br>
Uptime: 1 hour, 7 minutes
    </div>
</footer>

</body>
</html>
