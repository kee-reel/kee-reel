<!DOCTYPE html>
<html lang="ru">
	<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
	<meta name="description" content="IT простым языком">
	<meta name="generator" content="HUGO">

	<meta name="theme-color" content="#ffffff">

    
    <link rel="stylesheet" href="/sass/main.min.2410c89c79b6e042a424a6cef6ba5cbff430844ddffbec9f142931da8c515642.css" integrity="sha256-JBDInHm24EKkJKbO9rpcv/QwhE3f&#43;&#43;yfFCkx2oxRVkI=">
    <title> IT простым языком </title>
</head>

<body>
	<div id="top"/>
<header>
    <div align="center">
        +---------------------------+<br>
        |.-------------------------.|<br>
        ||&nbsp;<a href="/">kee_reel@blog</a>:~$ cd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/c">c</a>&nbsp;&nbsp;<a href="/cpp">c++</a>&nbsp;&nbsp;<a href="/python">python</a>&nbsp;&nbsp;<a href="/linux">linux</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;<a href="/opengl">opengl</a>&nbsp;&nbsp;<a href="/sql">sql</a>&nbsp;&nbsp;<a href="/network">networks</a>&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||<br>
        ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/about">обо_мне</a>&nbsp;||<br>
        |.-------------------------.|<br>
        +-::---------------------::-+<br>
        .---------------------------.<br>
        &nbsp;//&nbsp;/o<a href="/links">o</a>oooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        &nbsp;//&nbsp;/oooooooooooooooooooooooo\\&nbsp;\\&nbsp;<br>
        //-------------------------------\\<br>
        \\-------------------------------//<br>
    </div>
    <hr>
</header>

		
	<div id="wrapper">
		<div class="container">
			<section id="main_content">
    
    
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/c/loops/">◀ Циклы</a>
            
            
                <a href="https://kee-reel.com/c/arrays/">Массивы ▶</a>
            
        </div>
        <hr>
    
    <h1>C. Указатели</h1>
    
    
        <h3>Время чтения: 10 мин</h3>
    
    <p>Указатель (pointer) &ndash; это переменная, в которой хранится адрес на какую-то ячейку памяти.</p>
<p>Обычно, все боятся C и C++ из-за указателей &ndash; они кажутся чем-то непонятным и очень приближённым к тому, как устроен компьютер.</p>
<p>Однако, мне кажется, что даже такую сложную концепцию можно объяснить на аналогиях из реальной жизни, что значительно упростит понимание.</p>
<h1 id="ищем-клад">Ищем клад</h1>
<p>Представь себе, что ты искатель клада &ndash; без чего не обходится ни один поиск клада? Правильно, без карты!</p>
<p>Ситуация &ndash; у тебя есть карта, на которой отмечены координаты клада, например: 59.606067, 30.441917.</p>
<p>А теперь проводим аналогию с языком Си:</p>
<ul>
<li>Клад &ndash; переменная</li>
<li>Карта &ndash; указатель</li>
<li>Координаты &ndash; адрес</li>
</ul>
<p>То есть, карта с координатами клада &ndash; это указатель с адресом переменной.</p>
<p>Давай создадим указатель на переменную:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// Обычная int переменная
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> treasure <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Указатель на int переменную (на это указывает * после типа int)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> treasure_map;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Записываем адрес int переменной treasure в указатель treasure_map
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>treasure_map <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;treasure: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;coordinates of treasure: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates of treasure: 0x7ffe461b4bec
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;coordinates in treasure_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates in treasure_map: 0x7ffe461b4bec
</span></span></span></code></pre></div><p>Давай разберём что вывела программа:</p>
<ul>
<li>&ldquo;treasure: 777&rdquo; &ndash; значение нашей переменной (клад)</li>
<li>&ldquo;coordinates of treasure: 0x7ffe461b4bec&rdquo; &ndash; адрес переменной (координаты клада)</li>
<li>&ldquo;coordinates in treasure_map: 0x7ffe461b4bec&rdquo; &ndash; значение указателя (координаты, записанные в карте)</li>
</ul>
<p>А почему адрес так выглядит?</p>
<h1 id="адрес-и-представление-числа-в-памяти">Адрес и представление числа в памяти</h1>
<p>Адрес это номер ячейки в оперативной памяти. Записывается этот адрес в шеснадцатеричной системе счисления.</p>
<p><img src="/assets/images/pointer-to-variable.png" alt="Указатель на переменную"></p>
<p>Ты можешь представить адрес, как номер ячейки внутри своей плашки оперативной памяти. Каждая ячейка там занимает ровно 1 байт.</p>
<p>Например, у меня 16 Гб оперативной памяти &ndash; значит будет 16(Гб) * 1024(Мб) * 1024(Кб) = 16777216 байт. Это значит что возможные адреса находятся на промежутке от 0 до 16777215, или в шеснадцатеричной от 0x0 до 0xFFFFFF.</p>
<blockquote>
<p>У меня в примере адрес больше чем 0xFFFFFF, потому что на самом деле всё чуть сложнее. Я не буду объяснять про виртуализацию памяти, поэтому воспринимай этот момент пока в упрощённом виде, как я объснил выше. Но если очень интересно, то вот страница на <a href="https://ru.wikipedia.org/wiki/%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C">википедии</a>.</p>
</blockquote>
<p>Ещё, ты возможно заметил, что в моём примере число в ячейках записано как-то задом наперёд &ndash; сначала идут значения, а затем нули, хотя на листочке мы бы записали это двоичное число наоборот.</p>
<p>Всё дело в порядке байт в записи числа:</p>
<p><img src="/assets/images/little-big-endian.png" alt="Порядок байт"></p>
<p>В зависимости от процессора, порядок записи байт у тебя может быть:</p>
<ul>
<li>От старшего к младшему (big-endian) &ndash; первый байт числа хранит старшие биты, а последний младшие</li>
<li>От младшего к старшему (little-endian) &ndash; первый байт числа хранит младшие биты, а последний старшие</li>
</ul>
<p>Чуть позже в статье мы увидим вживую как это проявляется.</p>
<h3 id="размер-указателя">Размер указателя</h3>
<p>Ты наверно помнишь, что:</p>
<ul>
<li>char занимает 1 байт</li>
<li>short int занимает 2 байта</li>
<li>float занимает 4 байта</li>
<li>double занимает 8 байт</li>
</ul>
<p>Так вот &ndash; любые указатели занимают 4 байта или 8 байт:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> x;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;size of pointer: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(x));
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Вывод: size of pointer: 8
</span></span></span></code></pre></div><p>У меня он занимает 8 байт. От чего зависит сколько байт будет занимать указатель?</p>
<p>В 32-х битных операционных системах, поддерживается работа с оперативной памятью до 4-х гигабайт &ndash; это адреса от 0 до 4294967295. Такое количество адресов идеально вмещается в 4 байта &ndash; поэтому указатель занимает 4 байта, чтобы туда влез адрес на любую ячейку в памяти.</p>
<p>В 64-x битных системах указатель вмещается в 8 байт &ndash; тут уже можно раздать адреса на петабайты памяти.</p>
<h1 id="вытаскиваем-клад">Вытаскиваем клад</h1>
<p>Чего смотреть на эту карту &ndash; давай пойдём по координатам, указанным в карте, и выкопаем клад.</p>
<p>Применяя эту аналогию к Си &ndash; мы можем получить значение переменной, адрес которой хранится в указателе:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> treasure <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> treasure_map <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;coordinates in treasure_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure_map);
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;treasure by coordinates in treasure_map: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Вывод:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">cooridnates in treasure_map: 0x7ffe461b4bec
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">treasure by coordinates in treasure_map: 777 */</span>
</span></span></code></pre></div><p>То есть, чтобы получить значение по адресу, который хранится в указателе, надо указать звёздочку &ldquo;*&rdquo; перед именем указателя.</p>
<blockquote>
<p>Операция получения значения по указателю называется разыменованием.</p>
</blockquote>
<h1 id="закапываем-новый-клад">Закапываем новый клад</h1>
<p>У тебя есть карта с координатами клада &ndash; ты можешь пойти на это место, выкопать старый клад и закопать новый.</p>
<p>Применяя аналогию к Си &ndash; можно заменить значение в переменной, адрес которой хранится в указателе:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> treasure <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> treasure_map <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;treasure: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">*</span>treasure_map <span style="color:#f92672">=</span> <span style="color:#ae81ff">666</span>;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;new treasure: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// new treasure: 666
</span></span></span></code></pre></div><h1 id="карта-которая-является-сокровищем">Карта, которая является сокровищем</h1>
<p>Безумный искатель сокровищ нарисовал карту, в которой записаны координаты, где лежит эта карта.</p>
<p>Проводя аналогию с языком Си &ndash; безумный программист присвоил указателю адрес на этот же указатель.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> p_x;
</span></span><span style="display:flex;"><span>p_x <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>p_x;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;%p %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, p_x, <span style="color:#f92672">*</span>p_x);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 0x7ffd164172d0 373387984
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span>p_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">255</span>;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;%p %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, p_x);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 0x7ffd000000ff 255
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Теперь нельзя выводить значение через *p_x, потому что
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// он указывает на несуществующий адрес FF.
</span></span></span></code></pre></div><p>Ситуация, в которой указатель указывает сам на себя опасна, если ты попытаешься присвоить туда не адрес, а какое-то значение.</p>
<p>Это очень экзотическая ситуация &ndash; просто будь в курсе, что это возможно.</p>
<h1 id="переписываем-координаты-из-одной-карты-в-другую">Переписываем координаты из одной карты в другую</h1>
<p>Представь, что у тебя ещё есть друг искатель клада, с которым то хочешь поделиться координатами клада. Для этого ты возьмёшь его карту, и запишешь в неё координаты из своей карты.</p>
<p>Применяем аналогию к Си &ndash; ты можешь из одного указателя, записать значение в другой указатель:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> treasure <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> my_map <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> friend_map <span style="color:#f92672">=</span> my_map;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;treasure: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;coordinates in my_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, my_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates in my_map: 0x7ffc7cac03a4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;treasure by my_map: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>my_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure by my_map: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;coordinates in friend_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, friend_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates in friend_map: 0x7ffc7cac03a4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;treasure by friend_map: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>friend_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure by friend_map: 777
</span></span></span></code></pre></div><h1 id="карта-с-координатами-другой-карты">Карта с координатами другой карты</h1>
<p>Представь, что кто-то захотел очень хорошо спрятать клад, и он сделал две карты:</p>
<ul>
<li>В карте &ldquo;А&rdquo; записаны координаты клада</li>
<li>В карте &ldquo;В&rdquo; записаны координаты карты &ldquo;А&rdquo;</li>
</ul>
<p>Если у тебя есть карта &ldquo;В&rdquo;, то тебе надо по ней найти карту &ldquo;А&rdquo;, чтобы по ней уже найти клад.</p>
<p><img src="/assets/images/pointer-to-pointer.png" alt="Карта с координатами карты"></p>
<p>Применяем аналогию к Си &ndash; ты можешь создать указатель, в котором лежит адрес указателя на переменную:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> treasure <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> map_A <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">**</span> map_B <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>map_A;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;coordinates in map_B: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, map_B);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates in map_B: 0x7ffe82475c28
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;coordinates of map_A: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>map_A);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates of map_A: 0x7ffe82475c28
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;coordinates in map_A: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>map_B);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates in map_A: 0x7ffe82475c24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;coordinates of treasure: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// coordinates of treasure: 0x7ffe82475c24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;treasure: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">**</span>map_B);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure: 777
</span></span></span></code></pre></div><p>Вот эта последняя строчка, где написано &ldquo;**map_B&rdquo; &ndash; самая сложная. Здесь, мы идём по координатам из карты &ldquo;В&rdquo;, находим карту &ldquo;А&rdquo;, и уже по карте &ldquo;А&rdquo;, достаём клад.</p>
<h1 id="разные-типы-указателей">Разные типы указателей</h1>
<p>Тут уже мои аналогии начнут трещать по швам, потому что в языке Си указатели могут быть разных типов.</p>
<p>Поэтому давай я тут объясню без аналогий, но с визуальным пояснением.</p>
<h3 id="кусочек-переменной">Кусочек переменной</h3>
<p>Допустим у тебя есть int указатель на int переменную &ndash; а что, если у тебя будет char указатель на int переменную?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> treasure <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> int_treasure_map <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Явное приведение int* к char*, чтобы компилятор не ругался
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> char_treasure_map <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;treasure: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;address in int_treasure_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, int_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// address in int_treasure_map: 0x7ffd9ec2e014
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;address in char_treasure_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, char_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// address in char_treasure_map: 0x7ffd9ec2e014
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;value by int_treasure_map: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>int_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by int_treasure_map: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;value by char_treasure_map: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>char_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by char_treasure_map: 9
</span></span></span></code></pre></div><p><img src="/assets/images/pointers-different-types.png" alt="Разные типы указателей"></p>
<p>Помнишь, я упомянал до этого про порядок байт? В этом примере мы увидели вживую что это такое.</p>
<p>У меня получилось, что char_treasure_map вернул нам значение первого байта int переменной treasure. Почему только первый байт? Потому что это указатель на char, а char занимает 1 байт.</p>
<p>Если бы у меня был порядок байт не &ldquo;от младшего к старшему&rdquo;, а &ldquo;от старшего к младшему&rdquo;, то мне вернулось бы значение 0, так как первыми байтами числа были старшие байты (а там первые два байта это нули).</p>
<h3 id="не-тот-тип-переменной">Не тот тип переменной</h3>
<p>Ещё ты можешь взять float переменную, создать указатель на int, и указать его на float переменную:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">float</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> p_x <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>x;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;Interpret x as float: %f</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Interpret x as int: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, x, <span style="color:#f92672">*</span>p_x);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Interpret x as float: 777.000000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Interpret x as int: 1145192448
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span>p_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;Interpret x as float: %f</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Interpret x as int: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, x, <span style="color:#f92672">*</span>p_x);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Interpret x as float: 0.000000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Interpret x as int: 777
</span></span></span></code></pre></div><p>Изначально мы присвоили в переменную &ldquo;x&rdquo; значение 777 как во float переменную &ndash; в память оно и записалось в вещественном представлении. Затем, мы присвоили значение 777 по int указателю &ldquo;p_x&rdquo; &ndash; туда, куда указывает &ldquo;p_x&rdquo; (в переменную &ldquo;x&rdquo;) мы записали его в целочисленном представлении.</p>
<p>Вот наглядная демострация того, как выглядят разные представления числа 777:</p>
<p><img src="/assets/images/pointer-data-representation.png" alt="Разное представление типов"></p>
<p>Если мы будем интерпретировать вещественную запись числа как целую, или целую как вещественную &ndash; мы не сможем нормально прочитать нужное нам значение. Это как если бы мы начали читать книгу на чешском по-русски, и наоборот &ndash; что-то мы поймём, но значение слов будет разным.</p>
<p>То, что я показал является экзотическими случаями и на практике нигде не встречается. Не делай так никогда-никогда!</p>
<p><strong>Всегда следи, что типы указателей и переменных совпадают, а в указателях записаны корректные адреса.</strong></p>
<h3 id="тип-void">Тип void</h3>
<p>Кроме уже известных тебе типов (char, short int, int, float, double), указатель может быть ещё и типом void. Его особенности:</p>
<ul>
<li>Нужен для хранения ардеса переменной, независимо от её типа</li>
<li>Указатель типа void нельзя разыменовать &ndash; можно только считывать адрес</li>
</ul>
<p>Вот пример использования void:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span><span style="color:#f92672">*</span> p <span style="color:#f92672">=</span> (<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>x;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;address in void pointer: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, p);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Разыменовывать его нельзя, но мы можем его сначала
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// привести к нужному типу, а потом разыменовать
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;value by void pointer: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>((<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span>)p));
</span></span></code></pre></div><h1 id="адресная-арифметика">Адресная арифметика</h1>
<p>Адреса в указателях можно не только хранить, то и как-то изменять &ndash; например сдвигать указатель на соседние ячейки.</p>
<p>Давай я возьму предыдущий пример, и покажу как это выглядит:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> treasure <span style="color:#f92672">=</span> <span style="color:#ae81ff">777</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> int_treasure_map <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>treasure;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> char_treasure_map <span style="color:#f92672">=</span> ((<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>treasure);
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;treasure: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, treasure);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// treasure: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;address in int_treasure_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, int_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// address in int_treasure_map: 0x7ffe5123e044
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;address in char_treasure_map: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, char_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// address in char_treasure_map: 0x7ffe5123e044
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;value by int_treasure_map: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>int_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by int_treasure_map: 777
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;value by char_treasure_map+0: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>char_treasure_map);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by char_treasure_map+0: 9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>printf(<span style="color:#e6db74">&#34;value by char_treasure_map+1: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>(char_treasure_map<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by char_treasure_map+1: 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// А могу ещё и в переменную засунуть
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> char_treasure_map_2 <span style="color:#f92672">=</span> ((<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>treasure) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;value by char_treasure_map+2: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>char_treasure_map_2);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by char_treasure_map+2: 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// А могу ещё вот так на 1 вперёд сдвинуть
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>char_treasure_map_2<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;value by char_treasure_map+3: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>char_treasure_map_2);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by char_treasure_map+3: 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// А могу в обратную сторону сдвинуть
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>char_treasure_map_2 <span style="color:#f92672">-=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;value by char_treasure_map+0: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>char_treasure_map_2);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// value by char_treasure_map+0: 9
</span></span></span></code></pre></div><p><img src="/assets/images/pointers-arithmetic.png" alt="Адресная арифметика"></p>
<p>Если ты прибавляешь/отнимаешь от указателя на char единицу, то адрес изменится на 1, а если ты прибавишь/отнимешь единицу от указателю на int, то адрес изменится на 4. Почему так происходит?</p>
<p>Тут как раз вступают типы указателей &ndash; в зависимости от типа указателя, смещение происходит на число байт, равное размеру значения этого типа. То есть, для:</p>
<ul>
<li>void и char смещаемся на 1 байт</li>
<li>short int смещаемся на 2 байта</li>
<li>int и float смещаемся на 4 байт</li>
<li>double смещаемся на 8 байт</li>
</ul>
<h1 id="сравнение-адресов">Сравнение адресов</h1>
<p>Ещё их можно между собой сравнивать:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> a, b;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>p_a <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>a, <span style="color:#f92672">*</span>p_b <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>b;
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;a: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">b: %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, p_a, p_b);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (p_a <span style="color:#f92672">&lt;</span> p_b)
</span></span><span style="display:flex;"><span>	printf(<span style="color:#e6db74">&#34;Variable &#39;b&#39; has bigger address</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Variable &#39;a&#39; has bigger address</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span></code></pre></div><p>У получается такой вывод:</p>
<pre tabindex="0"><code>a: 0x7ffca02f6860
b: 0x7ffca02f6864
Variable &#39;b&#39; has bigger address
</code></pre><p>Попробуй запустить у себя, скорее всего у тебя будет наоборот &ndash; адрес &ldquo;a&rdquo; будет больше адреса &ldquo;b&rdquo;.</p>
<p>Почему? У меня стоит операционная система Linux, а на ней адреса, при создании новых переменных, растут от меньших к большим. То есть сначала в памяти выделются ячейки для переменной &ldquo;a&rdquo;, а затем для переменной &ldquo;b&rdquo; новые ячейки выделяется справа от &ldquo;a&rdquo;.</p>
<p>У тебя же скорее всего стоит Windows &ndash; в ней адреса при создании переменных растут в обратном направлении, от больших к меньшим. То есть сначала в памяти выделяются ячейки для переменной &ldquo;a&rdquo;, а затем для переменной &ldquo;b&rdquo; новые ячейки выделяются слева от ячейки &ldquo;a&rdquo;.</p>
<h1 id="заключение">Заключение</h1>
<p>Итого, ты узнал что такое:</p>
<ul>
<li>Указатель (карта)</li>
<li>Адрес (координаты)</li>
<li>Порядок байт (от большего к меньшему, от меньшего к большему)</li>
<li>Разыменование (получение значения переменной, на которую указывает указатель)</li>
<li>Указатель на указатель (карта, на которой указаны координаты другой карты)</li>
<li>Тип указателя (если тип не совпадает, то можно что-то сломать; странный тип void)</li>
<li>Адресная арифметика (перемещаемся туда-сюда относительно текущего адреса на кол-во байт, зависящее от размера типа)</li>
<li>Сравнение адресов (сравниваем адреса; адреса выделяются по-разному в разных ОС)</li>
</ul>
<p>Ты отлично постарался! Это очень сложная тема, и ничего страшного, если с первого раза что-то не понятно. На реальных задачах эта тема уже усвоится окончательно.</p>
<p>А реальные задачи появятся в следующей статье, в которой мы рассмотрим массивы.</p>

    <hr>
    <div align="center">
        <a href="https://kee-reel.com/c/pointers/#top">▲ В начало ▲</a>
    </div>
    
        <hr>
        <div style="display: flex; justify-content: space-between;">
            
                <a href="https://kee-reel.com/c/loops/">◀ Циклы</a>
            
            
                <a href="https://kee-reel.com/c/arrays/">Массивы ▶</a>
            
        </div>
    

			</section>
		</div>
	</div>

    <footer>
    <hr>
    <div align="center">
        Home server: Raspberry Pi 4<br>
        Temperature: 53<br>
Uptime: 1 hour, 7 minutes
    </div>
</footer>

</body>
</html>
